<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='../static/styles/styles.css') }}">
</head>
<body>
    <header>
        <h1>Our Products</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('home') }}">Home</a></li>
                <li><a href="{{ url_for('about') }}">About</a></li>
                <li><a href="{{ url_for('page3') }}">Products</a></li>
                <li><a href="{{ url_for('cart') }}">Cart</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <h2>Products in {{ selected_category.category_name if selected_category else 'All Categories' }}</h2>
        
        <!-- Category Selection -->
        <div class="category-select">
            <label for="category">Select Category:</label>
            <select id="category" name="category" onchange="window.location.href='{{ url_for('page3') }}?category=' + this.value">
                <option value="">All Categories</option>
                {% for category in sorted_categories %}
                    <option value="{{ category.id }}" {% if selected_category_id and category.id == selected_category_id %}selected{% endif %}>
                        {{ category.category_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Product Listing -->
        <div class="product-list">
            {% if paged_products %}
                {% for product in paged_products %}
                    <div class="product-item">
                        <img src="{{ product.image_url }}" alt="{{ product.product_name }}">
                        <h3>{{ product.product_name }}</h3>
                        
                        <!-- Unit Price -->
                        <p><strong>Unit Price:</strong> ${{ product.unit_price }}</p>

                        <!-- Discount Details -->
                        {% if product.discount and product.discount.discount_percentage > 0 %}
                            <p><strong>Discount:</strong> {{ product.discount.discount_percentage }}%</p>
                            <p><strong>Price after discount:</strong> 
                                ${{ product.unit_price * (1 - product.discount.discount_percentage / 100) | round(2) }}
                            </p>
                        {% else %}
                            <p><strong> </strong> </p>
                        {% endif %}

                        <a href="{{ url_for('single', product_id=product.id) }}">View Details</a>
                    </div>
                {% endfor %}
            {% else %}
                <p>No products available.</p>
            {% endif %}
        </div>

        <!-- Pagination -->
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('page3', category=selected_category_id, page=page-1) }}">&laquo; Previous</a>
            {% endif %}
            <span>Page {{ page }} of {{ total_pages }}</span>
            {% if page < total_pages %}
                <a href="{{ url_for('page3', category=selected_category_id, page=page+1) }}">Next &raquo;</a>
            {% endif %}
        </div>
    </main>
    <footer>
        <p>&copy; 2024 Grocery Shop. All rights reserved.</p>
    </footer>
</body>
</html>
